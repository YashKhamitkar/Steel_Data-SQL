--------------------------------------------------------
SELECT * FROM cars;  -- count = 8
SELECT * FROM SALES; -- COUNT = 20
SELECT * FROM salespersons; -- count  = 4

-- creating a master table as 'MASTER_SALE'

CREATE TABLE MASTER_SALE AS(
    SELECT S.*, C.MAKE, C.TYPE, C.STYLE, C.COST_$, P.NAME, P.AGE, P.CITY FROM SALES AS S
    JOIN SALESPERSONS AS P ON S.SALESMAN_ID=P.SALESMAN_ID
    JOIN CARS AS C ON C.CAR_ID=S.CAR_ID);
SELECT * FROM MASTER_SALE;
-- 1. What are the details of all cars purchased in the year 2022?

SELECT c.*, s.purchase_date FROM cars AS c
JOIN sales AS s ON c.car_id=s.car_id
WHERE YEAR(s.purchase_date)=2022;

-- 2. What is the total number of cars sold by each salesperson?

SELECT s.salesman_ID, p.name, p.City, Number_of_Car_Sold FROM
(SELECT s.salesman_ID, COUNT(s.sale_ID) AS Number_of_Car_Sold FROM sales as s
GROUP BY s.salesman_id) s JOIN salespersons as p ON s.salesman_ID=p.salesman_id
ORDER BY Number_of_Car_Sold DESC;

-- 3. What is the total revenue generated by each salesperson?

SELECT NAME, SUM(COST_$) AS Revenue_By_Salesperson FROM master_sale
GROUP BY SALESMAN_ID, 1
ORDER BY 2 DESC;

--    4. What are the details of the cars sold by each salesperson?

SELECT name, car_id, concat(make,' ', type,' ', style) AS car_details, COUNT(car_id) AS Number_of_car_sold from master_sale
group by name, car_id, make, type, style
ORDER BY name, car_id;

--5. What is the total revenue generated by each car type?
SELECT type, SUM(cost_$) AS revenue FROM master_sale
GROUP BY type
ORDER BY revenue DESC;

--          6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?        
SELECT car_id, concat(make,' ', type,' ', style) AS car_details, concat(name,', ', city) AS salesman, count(car_id) AS number_of_cars_sold 
, YEAR(purchase_date) as year FROM master_sale
WHERE name='Emily Wong' AND year=2021
GROUP BY car_id, salesman_id, name, make, city, type, style, year
ORDER BY car_id;

--    7. What is the total revenue generated by the sales of hatchback cars?
SELECT style, SUM(cost_$) as revenue FROM master_sale
WHERE style='Hatchback'
GROUP BY style;

--     8. What is the total revenue generated by the sales of SUV cars in the year 2022?   
SELECT style, SUM(cost_$) as revenue FROM master_sale
WHERE YEAR(purchase_date)=2022 AND style='SUV'
GROUP BY STYLE;

--   9. What is the name and city of the salesperson who sold the most numbers of cars in the year 2023?
   SELECT car_id, CONCAT(make,', ', type,', ', style) AS car_details, CONCAT(Name,', ', city) AS salesman, COUNT(car_id) AS number_of_car_sold, YEAR(purchase_date) AS year
FROM master_sale
WHERE YEAR(purchase_date)=2023
GROUP BY salesman_id,name,city,car_id,make,type,style,YEAR(purchase_date)
ORDER BY number_of_car_sold;

--    10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?
SELECT name, city, SUM(cost_$) AS revenue FROM master_sale
GROUP BY name, city
ORDER BY revenue DESC;
